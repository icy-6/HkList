import{d as D,v as $,x as q,y as G,b as I,n as E,z as j,A as z,B as W,g as t,C as X,D as K,E as Q,G as Y,H as Z,I as ee,J as ne,K as oe,L as ae,N as le,O as te,P as ie,q as re,M as b,s as se,e as ce,f,Q as ue,j as v,i as w,o as de}from"./index-DfK_AuQa.js";import{useFileListStore as fe}from"./fileList-DOI4PbIu.js";import{D as ve}from"./index-CizeZEZA.js";import{a as me,F as Ce}from"./index-BrDyvP4W.js";import{I as ge,S as pe}from"./index-jWhfq8_6.js";import{B as _e}from"./index-DfLWWs_9.js";/**
 * tdesign v1.13.2
 * (c) 2025 tdesign
 * @license MIT
 */var Fe={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(n){return["success","info","warning","error"].includes(n)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.13.2
 * (c) 2025 tdesign
 * @license MIT
 */var Ie=D({name:"TAlert",props:Fe,setup:function(n){var g=$("alert"),u=g.globalConfig,k=g.classPrefix,l=q({CheckCircleFilledIcon:oe,CloseIcon:ne,ErrorCircleFilledIcon:ee,HelpCircleFilledIcon:Z,InfoCircleFilledIcon:Y}),y=l.CheckCircleFilledIcon,r=l.CloseIcon,p=l.ErrorCircleFilledIcon,m=l.HelpCircleFilledIcon,S=l.InfoCircleFilledIcon,e=G("alert"),c=ae(),s=K(),i=I(null),d=I(null),_=I(0),x=I(!0),C=I(!0),H=function(){var o={info:S,success:y,warning:p,error:p,question:m},a=s("icon",o);return a?t("div",{class:"".concat(e.value,"__icon")},[a]):null},O=function(){var o=n.close,a=null;return o===!0||o===""?a=t(r,null,null):Q(o)?a=o:a=s("close"),a?t("div",{class:"".concat(e.value,"__close"),onClick:M},[a]):null},R=function(){var o=c("title");return o?t("div",{class:"".concat(e.value,"__title")},[" ",o]):null},U=function(){var o=c("operation");return t("div",{class:"".concat(e.value,"__message")},[B(),o?t("div",{class:"".concat(e.value,"__operation")},[o]):null])},B=function(){var o,a;a=c("default"),a||(a=c("message"));var A=le(a)?a.length:1,N=n.maxLine>0&&n.maxLine<A,V=(o=d.value)===null||o===void 0||(o=o.children[0])===null||o===void 0?void 0:o.offsetHeight;return N&&C.value?(a=a.slice(0,n.maxLine),V&&(d.value.style.height="".concat(_.value,"px"))):N&&V&&(d.value.style.height="".concat(V*(A-n.maxLine)+_.value,"px")),t("div",{class:"".concat(e.value,"__description"),ref:d},[N?a.map(function(T){return t("div",null,[T])}):a,N?t("div",{class:"".concat(e.value,"__collapse"),onClick:function(){C.value=!C.value}},[C.value?u.value.expandText:u.value.collapseText]):null])},J=function(){return t("div",{class:"".concat(e.value,"__content")},[R(),U()])},M=function(o){var a;(a=n.onClose)===null||a===void 0||a.call(n,{e:o}),te(i.value,"".concat(e.value,"--closing"))},L=function(o){var a=o.target===i.value;if(o.propertyName==="opacity"&&a){var A;x.value=!1,(A=n.onClosed)===null||A===void 0||A.call(n,{e:o})}};return E(function(){j(i.value,"transitionend",L),_.value=d.value.offsetHeight}),z(function(){W(i.value,"transitionend",L)}),function(){return t("div",{ref:i,class:["".concat(e.value),"".concat(e.value,"--").concat(n.theme),X({},"".concat(k.value,"-is-hidden"),!x.value)]},[H(),J(),O()])}}});/**
 * tdesign v1.13.2
 * (c) 2025 tdesign
 * @license MIT
 */var Ne=ie(Ie);const P=fe(),he=re("aria2",()=>{const h=I(!1),n=I({host:"ws://localhost:16800/jsonrpc",token:"",dir:""});E(()=>{const e=localStorage.getItem("aria2Config");e&&(n.value=JSON.parse(e))});const g=()=>h.value=!0,u=()=>h.value=!1,k=()=>{localStorage.setItem("aria2Config",JSON.stringify(n.value)),l=null};let l=null;const y=()=>new Promise((e,c)=>{l&&(l.close(),l=null);try{l=new WebSocket(n.value.host),l.onopen=()=>e(l),l.onerror=s=>{b.error("链接到Aria2下载器出错"),c(s)}}catch(s){b.error("链接到Aria2下载器出错"),c(s)}}),r=async(e,c=[])=>((!l||l.readyState!==WebSocket.OPEN)&&(l=await y()),new Promise((s,i)=>{l=l;const d="HkList"+Date.now().toString(),_={jsonrpc:"2.0",method:e,id:d,params:[`token:${n.value.token}`,...c]};l.onmessage=x=>{const C=JSON.parse(x.data);C.id===d&&(C.error?i(C.error):s(C.result))},l.send(JSON.stringify(_))})),p=async()=>{await r("aria2.getVersion"),b.success("测试连接成功")},m=async(e,c,s,i)=>{await r("aria2.addUri",[[e],{out:c,dir:n.value.dir===""?null:n.value.dir,header:[`User-Agent: ${s}`],split:i.toString()}]),b.success("添加链接成功")};return{aria2ConfigDialogVisible:h,showAria2Config:g,hideAria2Config:u,aria2ConfigForm:n,saveAria2Config:k,getAria2Version:p,addAria2Url:m,downloadLinks:async(e,c=0)=>{Array.isArray(e)||(e=[e]);for(const s of e){let i=s.filename;if(s.fs_id&&P.GetFileListRes){const d=P.GetFileListRes.list.find(_=>_.fs_id===s.fs_id);d&&(i=d.path)}await m(s.urls[c],i,s.ua,16)}}}}),Ve=D({__name:"Aria2Dialog",setup(h){const n=he(),{aria2ConfigDialogVisible:g,aria2ConfigForm:u}=se(n),k={},l=async({validateResult:y})=>{y===!0&&(n.saveAria2Config(),n.hideAria2Config(),b.success("保存成功"))};return(y,r)=>{const p=ge,m=me,S=_e,e=pe,c=Ce,s=ve;return de(),ce(s,{visible:v(g),"onUpdate:visible":r[3]||(r[3]=i=>ue(g)?g.value=i:null),header:"Aria2配置调整",footer:!1},{default:f(()=>[t(c,{data:v(u),rules:k,onSubmit:l},{default:f(()=>[t(m,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:f(()=>[t(p,{modelValue:v(u).host,"onUpdate:modelValue":r[0]||(r[0]=i=>v(u).host=i)},null,8,["modelValue"])]),_:1}),t(m,{label:"密钥",name:"token"},{default:f(()=>[t(p,{modelValue:v(u).token,"onUpdate:modelValue":r[1]||(r[1]=i=>v(u).token=i)},null,8,["modelValue"])]),_:1}),t(m,{label:"保存路径",name:"dir"},{default:f(()=>[t(p,{modelValue:v(u).dir,"onUpdate:modelValue":r[2]||(r[2]=i=>v(u).dir=i)},null,8,["modelValue"])]),_:1}),t(m,null,{default:f(()=>[t(e,{size:"small"},{default:f(()=>[t(S,{theme:"default",onClick:v(n).hideAria2Config},{default:f(()=>r[4]||(r[4]=[w(" 取消 ")])),_:1,__:[4]},8,["onClick"]),t(S,{onClick:v(n).getAria2Version},{default:f(()=>r[5]||(r[5]=[w(" 测试连接 ")])),_:1,__:[5]},8,["onClick"]),t(S,{type:"submit"},{default:f(()=>r[6]||(r[6]=[w(" 保存 ")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{Ne as A,Ve as _,he as u};
