import{v as $,x as q,y as G,g as t,d as D,z as j,A as z,B as W,b as S,n as E,C as X,D as K,E as Q,G as Y,H as Z,I as ee,J as ne,K as oe,L as ae,N as le,O as te,P as re,Q as ie,R as se,q as ce,M as b,s as ue,e as de,f as C,S as fe,j as g,i as w,o as ve}from"./index-Duc-iBXa.js";import{useFileListStore as me}from"./fileList-RtqKllYj.js";import{D as Ce}from"./index-S6BX1pVo.js";import{a as ge,F as pe}from"./index-C4XwCDNa.js";import{I as _e,S as Fe}from"./index-wWVzXTvK.js";import{B as Ie}from"./useResizeObserver-sH3_gnCw.js";/**
 * tdesign v1.11.5
 * (c) 2025 tdesign
 * @license MIT
 */function he(){var f=q();return function(d,c){var m;if($(f.props[d]))m=f.props[d](G);else if(f.slots[d])m=f.slots[d]&&f.slots[d](null)[0];else if(c){var o=c[f.props.theme];m=t(o,null,null)}return m}}/**
 * tdesign v1.11.5
 * (c) 2025 tdesign
 * @license MIT
 */var Se={close:{type:[String,Boolean,Function],default:!1},default:{type:[String,Function]},icon:{type:Function},maxLine:{type:Number,default:0},message:{type:[String,Function]},operation:{type:Function},theme:{type:String,default:"info",validator:function(e){return["success","info","warning","error"].includes(e)}},title:{type:[String,Function]},onClose:Function,onClosed:Function};/**
 * tdesign v1.11.5
 * (c) 2025 tdesign
 * @license MIT
 */var Ae=D({name:"TAlert",props:Se,setup:function(e){var d=j("alert"),c=d.globalConfig,m=d.classPrefix,o=z({CheckCircleFilledIcon:le,CloseIcon:ae,ErrorCircleFilledIcon:oe,HelpCircleFilledIcon:ne,InfoCircleFilledIcon:ee}),A=o.CheckCircleFilledIcon,i=o.CloseIcon,F=o.ErrorCircleFilledIcon,p=o.HelpCircleFilledIcon,k=o.InfoCircleFilledIcon,n=W("alert"),u=te(),s=he(),r=S(null),v=S(null),I=S(0),x=S(!0),_=S(!0),R=function(){var a={info:k,success:A,warning:F,error:F,question:p},l=s("icon",a);return l?t("div",{class:"".concat(n.value,"__icon")},[l]):null},H=function(){var a=e.close,l=null;return a===!0||a===""?l=t(i,null,null):Z(a)?l=a:l=s("close"),l?t("div",{class:"".concat(n.value,"__close"),onClick:M},[l]):null},O=function(){var a=u("title");return a?t("div",{class:"".concat(n.value,"__title")},[" ",a]):null},U=function(){var a=u("operation");return t("div",{class:"".concat(n.value,"__message")},[B(),a?t("div",{class:"".concat(n.value,"__operation")},[a]):null])},B=function(){var a,l;l=u("default"),l||(l=u("message"));var y=re(l)?l.length:1,N=e.maxLine>0&&e.maxLine<y,V=(a=v.value)===null||a===void 0||(a=a.children[0])===null||a===void 0?void 0:a.offsetHeight;return N&&_.value?(l=l.slice(0,e.maxLine),V&&(v.value.style.height="".concat(I.value,"px"))):N&&V&&(v.value.style.height="".concat(V*(y-e.maxLine)+I.value,"px")),t("div",{class:"".concat(n.value,"__description"),ref:v},[N?l.map(function(P){return t("div",null,[P])}):l,N?t("div",{class:"".concat(n.value,"__collapse"),onClick:function(){_.value=!_.value}},[_.value?c.value.expandText:c.value.collapseText]):null])},J=function(){return t("div",{class:"".concat(n.value,"__content")},[O(),U()])},M=function(a){var l;(l=e.onClose)===null||l===void 0||l.call(e,{e:a}),ie(r.value,"".concat(n.value,"--closing"))},L=function(a){var l=a.target===r.value;if(a.propertyName==="opacity"&&l){var y;x.value=!1,(y=e.onClosed)===null||y===void 0||y.call(e,{e:a})}};return E(function(){X(r.value,"transitionend",L),I.value=v.value.offsetHeight}),K(function(){Q(r.value,"transitionend",L)}),function(){return t("div",{ref:r,class:["".concat(n.value),"".concat(n.value,"--").concat(e.theme),Y({},"".concat(m.value,"-is-hidden"),!x.value)]},[R(),J(),H()])}}});/**
 * tdesign v1.11.5
 * (c) 2025 tdesign
 * @license MIT
 */var Le=se(Ae);const T=me(),ke=ce("aria2",()=>{const f=S(!1),e=S({host:"ws://localhost:16800/jsonrpc",token:"",dir:""});E(()=>{const n=localStorage.getItem("aria2Config");n&&(e.value=JSON.parse(n))});const d=()=>f.value=!0,c=()=>f.value=!1,m=()=>{localStorage.setItem("aria2Config",JSON.stringify(e.value)),o=null};let o=null;const A=()=>new Promise((n,u)=>{o&&(o.close(),o=null);try{o=new WebSocket(e.value.host),o.onopen=()=>n(o),o.onerror=s=>{b.error("链接到Aria2下载器出错"),u(s)}}catch(s){b.error("链接到Aria2下载器出错"),u(s)}}),i=async(n,u=[])=>((!o||o.readyState!==WebSocket.OPEN)&&(o=await A()),new Promise((s,r)=>{o=o;const v="HkList"+Date.now().toString(),I={jsonrpc:"2.0",method:n,id:v,params:[`token:${e.value.token}`,...u]};o.onmessage=x=>{const _=JSON.parse(x.data);_.id===v&&(_.error?r(_.error):s(_.result))},o.send(JSON.stringify(I))})),F=async()=>{await i("aria2.getVersion"),b.success("测试连接成功")},p=async(n,u,s,r)=>{await i("aria2.addUri",[[n],{out:u,dir:e.value.dir===""?null:e.value.dir,header:[`User-Agent: ${s}`],split:r.toString()}]),b.success("添加链接成功")};return{aria2ConfigDialogVisible:f,showAria2Config:d,hideAria2Config:c,aria2ConfigForm:e,saveAria2Config:m,getAria2Version:F,addAria2Url:p,downloadLinks:async(n,u=0)=>{Array.isArray(n)||(n=[n]);for(const s of n){let r=s.filename;if(s.fs_id&&T.GetFileListRes){const v=T.GetFileListRes.list.find(I=>I.fs_id===s.fs_id);v&&(r=v.path)}await p(s.urls[u],r,s.ua,16)}}}}),Pe=D({__name:"Aria2Dialog",setup(f){const e=ke(),{aria2ConfigDialogVisible:d,aria2ConfigForm:c}=ue(e),m={},o=async({validateResult:A})=>{A===!0&&(e.saveAria2Config(),e.hideAria2Config(),b.success("保存成功"))};return(A,i)=>{const F=_e,p=ge,k=Ie,n=Fe,u=pe,s=Ce;return ve(),de(s,{visible:g(d),"onUpdate:visible":i[3]||(i[3]=r=>fe(d)?d.value=r:null),header:"Aria2配置调整",footer:!1},{default:C(()=>[t(u,{data:g(c),rules:m,onSubmit:o},{default:C(()=>[t(p,{label:"主机地址",name:"host",help:"需要包括协议,端口,地址"},{default:C(()=>[t(F,{modelValue:g(c).host,"onUpdate:modelValue":i[0]||(i[0]=r=>g(c).host=r)},null,8,["modelValue"])]),_:1}),t(p,{label:"密钥",name:"token"},{default:C(()=>[t(F,{modelValue:g(c).token,"onUpdate:modelValue":i[1]||(i[1]=r=>g(c).token=r)},null,8,["modelValue"])]),_:1}),t(p,{label:"保存路径",name:"dir"},{default:C(()=>[t(F,{modelValue:g(c).dir,"onUpdate:modelValue":i[2]||(i[2]=r=>g(c).dir=r)},null,8,["modelValue"])]),_:1}),t(p,null,{default:C(()=>[t(n,{size:"small"},{default:C(()=>[t(k,{theme:"default",onClick:g(e).hideAria2Config},{default:C(()=>i[4]||(i[4]=[w(" 取消 ")])),_:1},8,["onClick"]),t(k,{onClick:g(e).getAria2Version},{default:C(()=>i[5]||(i[5]=[w(" 测试连接 ")])),_:1},8,["onClick"]),t(k,{type:"submit"},{default:C(()=>i[6]||(i[6]=[w(" 保存 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}});export{Le as A,Pe as _,ke as u};
