import{p as F,q as ae,b as T,M as h,d as E,s as L,e as z,j as l,Q as M,f as o,g as e,i as m,o as S,l as ie,n as ue,F as D,m as X,h as se,k as de,t as Z}from"./index-DfK_AuQa.js";import{c as O,L as re,a as me}from"./copy-DWXBTCCc.js";import{G as j,f as B,b as _e}from"./format-YoKwq1Pz.js";import{u as pe}from"./useCommonStore-Cm69_3M8.js";import{D as G}from"./index-CizeZEZA.js";import{F as Y,a as J}from"./index-BrDyvP4W.js";import{S as Q,O as H,T as ce}from"./index-CJhdthvT.js";import{I as N,S as P,C as fe}from"./index-jWhfq8_6.js";import{I as te}from"./index-3CbCL5Pk.js";import{B as q}from"./index-DfLWWs_9.js";import{D as ke,V as ge}from"./validates-CDOPXIkT.js";import{S as le}from"./index-BG3c6vWu.js";import{a as ye,D as be}from"./index--lHULiBS.js";import{T as ve}from"./index-B4XBjvuu.js";import{T as Ve}from"./index-BB20r3vW.js";import"./omit-BSm0-P2Q.js";import"./fake-arrow-XbHKTFne.js";import"./add-NVN9jDI3.js";import"./index-CIv83i9o.js";const we=k=>F.request("get","/admin/token",{params:k}),Se=k=>F.request("post","/admin/token",{data:k}),ee=k=>F.request("patch","/admin/token",{data:k}),Ue=k=>F.request("delete","/admin/token",{data:k}),Ce=(k,u="卡密列表.txt")=>{const _=new Blob([k],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(_),c=document.createElement("a");c.href=n,c.download=u,c.click(),URL.revokeObjectURL(n)},$=ae("tokens",()=>{const[k,u,_,n]=pe(we,()=>{c.value=[],v.value=[]},{keyword:""}),c=T([]),v=T([]),U=(b,I)=>{c.value=b,v.value=I.selectedRowData},a=T(!1),t=()=>a.value=!0,d=()=>a.value=!1,i=T({count:100,size:1e3,day:100,can_use_ip_count:5,type:"generate",generate_count:10,token_type:"normal"}),V=async()=>{const b=await Se({...i.value,size:i.value.size*j});Ce(b.data.tokens.join(`
`)),h.success("添加成功"),await n()},p=T(!1),g=()=>p.value=!0,C=()=>p.value=!1,w=T({id:[],switch:!0,reason:"手动操作"}),y=async()=>{if(c.value.length===0)return h.error("请选择卡密");await ee({...w.value,id:c.value}),h.success(`${w.value.switch?"启用":"禁用"}成功`),await n()},r=async()=>{if(c.value.length===0)return h.error("请选择卡密");await Ue({id:c.value}),c.value=[],h.success("删除成功"),await n()},R=T(!1),f=T({id:[],count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0,token_type:"normal"});return{tokenList:_,pagination:u,selectReq:k,getTokens:n,selectedRowKeys:c,handleSelectChange:U,isAddingToken:a,showAddingTokenDialog:t,hideAddingTokenDialog:d,addTokenReq:i,addToken:V,isUpdateSwitchDialog:p,showUpdateSwitchDialog:g,hideUpdateSwitchDialog:C,updateSwitchReq:w,updateSwitchSelection:y,deleteSelection:r,isEditDialog:R,updateReq:f,showEditDialog:(b,I)=>{if(b&&I?(b.stopPropagation(),f.value.id=[I]):f.value={id:c.value,count:100,size:1e3,day:100,can_use_ip_count:5,ip:[],expires_at:null,switch:!0,reason:"",token:void 0},f.value.id.length===1){const A=_.value.find(ne=>ne.id===f.value.id[0]);A&&(f.value={...A,size:A.size/j,id:f.value.id})}R.value=!0},hideEditDialog:()=>R.value=!1,updateSelection:async()=>{if(f.value.id.length===0)return h.error("请选择卡密");await ee({...f.value,size:(f.value.size??0)*j,token:f.value.id.length===1&&f.value.token==="guest"?void 0:f.value.token}),h.success("更新成功~"),await n()},copySelection:()=>{O(v.value.map(b=>`${b.token} | ${B(b.size)} | ${b.count} 次 | ${b.day} 天`).join(`
`))},copySelectionNoFormat:()=>{O(v.value.map(b=>b.token).join(`
`))}}}),De=E({__name:"AddToken",setup(k){const u=$(),{isAddingToken:_,addTokenReq:n}=L(u),c={token:[{required:!0,message:"卡密不能为空"}],generate_count:[{required:!0,message:"生成数量不能为空"}],count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},v=async({validateResult:U})=>{U===!0&&(await u.addToken(),u.hideAddingTokenDialog())};return(U,a)=>{const t=H,d=Q,i=J,V=N,p=te,g=q,C=P,w=Y,y=G;return S(),z(y,{visible:l(_),"onUpdate:visible":a[8]||(a[8]=r=>M(_)?_.value=r:null),header:"添加卡密",footer:!1},{default:o(()=>[e(w,{onSubmit:v,data:l(n),rules:c},{default:o(()=>[e(i,{name:"token_type",label:"卡密类型"},{default:o(()=>[e(d,{modelValue:l(n).token_type,"onUpdate:modelValue":a[0]||(a[0]=r=>l(n).token_type=r)},{default:o(()=>[e(t,{label:"普通模式",value:"normal"}),e(t,{label:"每日刷新模式",value:"daily"})]),_:1},8,["modelValue"])]),_:1}),e(i,{name:"type",label:"添加方式"},{default:o(()=>[e(d,{modelValue:l(n).type,"onUpdate:modelValue":a[1]||(a[1]=r=>l(n).type=r)},{default:o(()=>[e(t,{label:"手动添加",value:"set"}),e(t,{label:"自动添加",value:"generate"})]),_:1},8,["modelValue"])]),_:1}),l(n).type==="set"?(S(),z(i,{key:0,name:"token",label:"卡密"},{default:o(()=>[e(V,{modelValue:l(n).token,"onUpdate:modelValue":a[2]||(a[2]=r=>l(n).token=r)},null,8,["modelValue"])]),_:1})):(S(),z(i,{key:1,name:"generate_count",label:"生成数量"},{default:o(()=>[e(p,{min:1,modelValue:l(n).generate_count,"onUpdate:modelValue":a[3]||(a[3]=r=>l(n).generate_count=r)},null,8,["modelValue"])]),_:1})),e(i,{name:"count",label:"次数配额"},{default:o(()=>[e(p,{min:1,modelValue:l(n).count,"onUpdate:modelValue":a[4]||(a[4]=r=>l(n).count=r)},null,8,["modelValue"])]),_:1}),e(i,{name:"size",label:"大小配额(GB)"},{default:o(()=>[e(p,{min:1,modelValue:l(n).size,"onUpdate:modelValue":a[5]||(a[5]=r=>l(n).size=r)},null,8,["modelValue"])]),_:1}),e(i,{name:"day",label:"时间配额"},{default:o(()=>[e(p,{min:1,modelValue:l(n).day,"onUpdate:modelValue":a[6]||(a[6]=r=>l(n).day=r)},null,8,["modelValue"])]),_:1}),e(i,{name:"can_use_ip_count",label:"IP配额"},{default:o(()=>[e(p,{min:1,modelValue:l(n).can_use_ip_count,"onUpdate:modelValue":a[7]||(a[7]=r=>l(n).can_use_ip_count=r)},null,8,["modelValue"])]),_:1}),e(i,null,{default:o(()=>[e(C,{size:"small"},{default:o(()=>[e(g,{theme:"default",onClick:l(u).hideUpdateSwitchDialog},{default:o(()=>a[9]||(a[9]=[m(" 取消 ")])),_:1,__:[9]},8,["onClick"]),e(g,{type:"submit"},{default:o(()=>a[10]||(a[10]=[m(" 提交 ")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),ze=E({__name:"UpdateToken",setup(k){const u=$(),{isEditDialog:_,updateReq:n}=L(u),c={count:[{required:!0,message:"次数配额不能为空"}],size:[{required:!0,message:"大小配额不能为空"}],day:[{required:!0,message:"时间配额不能为空"}],can_use_ip_count:[{required:!0,message:"IP配额不能为空"}]},v=async({validateResult:a})=>{a===!0&&(await u.updateSelection(),u.hideEditDialog())},U=(a,t)=>{if(!(!t.item||typeof t.item=="number")){if(!ge(t.item)){h.error("请输入正确的 ip 地址");return}n.value.ip=a}};return(a,t)=>{const d=N,i=J,V=H,p=Q,g=te,C=ce,w=ke,y=le,r=q,R=P,f=Y,x=G;return S(),z(x,{visible:l(_),"onUpdate:visible":t[9]||(t[9]=s=>M(_)?_.value=s:null),header:"更新卡密",footer:!1},{default:o(()=>[e(f,{onSubmit:v,data:l(n),rules:c},{default:o(()=>[l(n).id.length===1&&l(n).token!=="guest"?(S(),z(i,{key:0,name:"token",label:"卡密"},{default:o(()=>[e(d,{modelValue:l(n).token,"onUpdate:modelValue":t[0]||(t[0]=s=>l(n).token=s)},null,8,["modelValue"])]),_:1})):ie("",!0),e(i,{name:"token_type",label:"卡密类型"},{default:o(()=>[e(p,{modelValue:l(n).token_type,"onUpdate:modelValue":t[1]||(t[1]=s=>l(n).token_type=s)},{default:o(()=>[e(V,{label:"普通模式",value:"normal"}),e(V,{label:"每日刷新模式",value:"daily"})]),_:1},8,["modelValue"])]),_:1}),e(i,{name:"count",label:"次数配额"},{default:o(()=>[e(g,{min:1,modelValue:l(n).count,"onUpdate:modelValue":t[2]||(t[2]=s=>l(n).count=s)},null,8,["modelValue"])]),_:1}),e(i,{name:"size",label:"大小配额(GB)"},{default:o(()=>[e(g,{min:1,modelValue:l(n).size,"onUpdate:modelValue":t[3]||(t[3]=s=>l(n).size=s)},null,8,["modelValue"])]),_:1}),e(i,{name:"day",label:"时间配额"},{default:o(()=>[e(g,{min:1,modelValue:l(n).day,"onUpdate:modelValue":t[4]||(t[4]=s=>l(n).day=s)},null,8,["modelValue"])]),_:1}),e(i,{name:"can_use_ip_count",label:"IP配额"},{default:o(()=>[e(g,{min:1,modelValue:l(n).can_use_ip_count,"onUpdate:modelValue":t[5]||(t[5]=s=>l(n).can_use_ip_count=s)},null,8,["modelValue"])]),_:1}),e(i,{name:"ip",label:"已绑IP",help:"回车添加"},{default:o(()=>[e(C,{value:l(n).ip,onChange:U},null,8,["value"])]),_:1}),e(i,{name:"expires_at",label:"过期时间"},{default:o(()=>[e(w,{modelValue:l(n).expires_at,"onUpdate:modelValue":t[6]||(t[6]=s=>l(n).expires_at=s),"enable-time-picker":"","allow-input":"",clearable:"",format:"YYYY-MM-DD hh:mm:ss"},null,8,["modelValue"])]),_:1}),e(i,{name:"switch",label:"启用"},{default:o(()=>[e(y,{modelValue:l(n).switch,"onUpdate:modelValue":t[7]||(t[7]=s=>l(n).switch=s)},null,8,["modelValue"])]),_:1}),e(i,{name:"reason",label:"原因"},{default:o(()=>[e(d,{modelValue:l(n).reason,"onUpdate:modelValue":t[8]||(t[8]=s=>l(n).reason=s)},null,8,["modelValue"])]),_:1}),e(i,{label:"选中的卡密"},{default:o(()=>[e(d,{value:JSON.stringify(l(n).id),disabled:""},null,8,["value"])]),_:1}),e(i,null,{default:o(()=>[e(R,{size:"small"},{default:o(()=>[e(r,{theme:"default",onClick:l(u).hideEditDialog},{default:o(()=>t[10]||(t[10]=[m(" 取消 ")])),_:1,__:[10]},8,["onClick"]),e(r,{type:"submit"},{default:o(()=>t[11]||(t[11]=[m(" 提交 ")])),_:1,__:[11]})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),Te=E({__name:"UpdateSwitch",setup(k){const u=$(),{isUpdateSwitchDialog:_,updateSwitchReq:n,selectedRowKeys:c}=L(u),v={},U=async({validateResult:a})=>{a===!0&&(await u.updateSwitchSelection(),u.hideUpdateSwitchDialog())};return(a,t)=>{const d=le,i=J,V=N,p=q,g=P,C=Y,w=G;return S(),z(w,{visible:l(_),"onUpdate:visible":t[2]||(t[2]=y=>M(_)?_.value=y:null),header:"启用/禁用卡密",footer:!1},{default:o(()=>[e(C,{onSubmit:U,data:l(n),rules:v},{default:o(()=>[e(i,{label:"启用",name:"switch"},{default:o(()=>[e(d,{modelValue:l(n).switch,"onUpdate:modelValue":t[0]||(t[0]=y=>l(n).switch=y)},null,8,["modelValue"])]),_:1}),e(i,{label:"原因",name:"reason"},{default:o(()=>[e(V,{modelValue:l(n).reason,"onUpdate:modelValue":t[1]||(t[1]=y=>l(n).reason=y)},null,8,["modelValue"])]),_:1}),e(i,{label:"选中的账号"},{default:o(()=>[e(V,{value:JSON.stringify(l(c)),disabled:""},null,8,["value"])]),_:1}),e(i,null,{default:o(()=>[e(g,{size:"small"},{default:o(()=>[e(p,{theme:"default",onClick:l(u).hideUpdateSwitchDialog},{default:o(()=>t[3]||(t[3]=[m(" 取消 ")])),_:1,__:[3]},8,["onClick"]),e(p,{type:"submit"},{default:o(()=>t[4]||(t[4]=[m(" 提交 ")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"])}}}),he={class:"buttons"},Qe=E({__name:"index",setup(k){const u=$(),{selectReq:_,tokenList:n,pagination:c,selectedRowKeys:v}=L(u);ue(u.getTokens);const U=T([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"id",title:"ID"},{colKey:"token",title:"卡密",width:200,ellipsis:!0},{colKey:"token_type",title:"卡密类型",cell:(a,{row:t})=>e(D,null,[t.token_type==="normal"?"普通模式":"每日刷新模式"]),ellipsis:!0},{colKey:"switch",title:"状态",cell:(a,{row:t})=>e(D,null,[t.switch?"启用":`禁用 (${t.reason})`]),ellipsis:!0},{colKey:"today_count",title:"今日解析",cell:(a,{row:t})=>e(D,null,[t.today_count,m(" ("),B(t.today_size??0),m(")")]),width:150,ellipsis:!0},{colKey:"total_count",title:"总计解析",cell:(a,{row:t})=>e(D,null,[t.total_count,m(" ("),B(t.total_size??0),m(")")]),width:150,ellipsis:!0},{colKey:"size",title:"大小配额",cell:(a,{row:t})=>e(D,null,[B(t.size)]),width:90,ellipsis:!0},{colKey:"count",title:"次数配额",cell:(a,{row:t})=>e(D,null,[t.count,m(" 次")]),width:90,ellipsis:!0},{colKey:"day",title:"时间配额",cell:(a,{row:t})=>e(D,null,[t.day,m(" 天")]),width:90,ellipsis:!0},{colKey:"can_use_ip_count",title:"IP配额",cell:(a,{row:t})=>e(D,null,[t.can_use_ip_count,m(" 个")]),ellipsis:!0},{colKey:"expires_at",title:"过期时间",cell:(a,{row:t})=>e(D,null,[t.expires_at===null?"未使用":_e(t.expires_at)]),width:175,ellipsis:!0},{colKey:"created_at",title:"创建时间",width:175,ellipsis:!0},{colKey:"updated_at",title:"更新时间",width:175,ellipsis:!0},{colKey:"operation",title:"操作",cell:(a,{row:t})=>e(q,{theme:"primary",onClick:d=>u.showEditDialog(d,t.id)},{default:()=>[m("编辑")]}),width:90,fixed:"right"}]);return(a,t)=>{const d=H,i=Q,V=N,p=q,g=P,C=ve,w=me,y=re,r=be,R=ye,f=Ve,x=fe;return S(),z(x,null,{default:o(()=>[X("div",he,[e(g,{size:"small"},{default:o(()=>[e(i,{modelValue:l(_).column,"onUpdate:modelValue":t[0]||(t[0]=s=>l(_).column=s),onChange:l(u).getTokens},{default:o(()=>[e(d,{label:"按 id 排序",value:"id"}),e(d,{label:"按 token 排序",value:"token"}),e(d,{label:"按 count 排序",value:"count"}),e(d,{label:"按 size 排序",value:"size"}),e(d,{label:"按 day 排序",value:"day"}),e(d,{label:"按 can_use_ip_count 排序",value:"can_use_ip_count"}),e(d,{label:"按 ip 排序",value:"ip"}),e(d,{label:"按 expires_at 排序",value:"expires_at"}),e(d,{label:"按 created_at 排序",value:"created_at"}),e(d,{label:"按 updated_at 排序",value:"updated_at"}),e(d,{label:"按 deleted_at 排序",value:"deleted_at"})]),_:1},8,["modelValue","onChange"]),e(i,{modelValue:l(_).direction,"onUpdate:modelValue":t[1]||(t[1]=s=>l(_).direction=s),onChange:l(u).getTokens},{default:o(()=>[e(d,{label:"正序",value:"asc"}),e(d,{label:"倒序",value:"desc"})]),_:1},8,["modelValue","onChange"]),e(V,{modelValue:l(_).keyword,"onUpdate:modelValue":t[2]||(t[2]=s=>l(_).keyword=s),onBlur:l(u).getTokens,placeholder:"请输入需要查询的卡密"},null,8,["modelValue","onBlur"]),e(p,{onClick:l(u).getTokens},{default:o(()=>t[3]||(t[3]=[m(" 刷新列表 ")])),_:1,__:[3]},8,["onClick"]),e(p,{onClick:l(u).showAddingTokenDialog},{default:o(()=>t[4]||(t[4]=[m(" 添加卡密 ")])),_:1,__:[4]},8,["onClick"]),e(p,{onClick:l(u).deleteSelection},{default:o(()=>t[5]||(t[5]=[m(" 批量删除 ")])),_:1,__:[5]},8,["onClick"]),e(p,{onClick:l(u).showUpdateSwitchDialog},{default:o(()=>t[6]||(t[6]=[m(" 批量启用/禁用 ")])),_:1,__:[6]},8,["onClick"]),e(p,{onClick:l(u).showEditDialog},{default:o(()=>t[7]||(t[7]=[m(" 批量更新 ")])),_:1,__:[7]},8,["onClick"]),e(p,{onClick:l(u).copySelection},{default:o(()=>t[8]||(t[8]=[m(" 批量复制 ")])),_:1,__:[8]},8,["onClick"]),e(p,{onClick:l(u).copySelectionNoFormat},{default:o(()=>t[9]||(t[9]=[m(" 无格式批量复制 ")])),_:1,__:[9]},8,["onClick"])]),_:1})]),e(De),e(Te),e(ze),e(f,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(n),pagination:l(c),columns:U.value,"select-on-row-click":!0,selectedRowKeys:l(v),onSelectChange:l(u).handleSelectChange},{expandedRow:o(({row:s})=>[e(R,{bordered:"",colon:"",layout:"vertical"},{default:o(()=>[e(r,{label:"已绑定的ip"},{default:o(()=>[s.ip.length===0?(S(),z(C,{key:0,size:"large"},{default:o(()=>t[10]||(t[10]=[m(" 没有绑定的IP ")])),_:1,__:[10]})):(S(),z(y,{key:1,stripe:"",split:"",size:"large"},{default:o(()=>[(S(!0),se(D,null,de(s.ip,(K,W)=>(S(),z(w,{key:K},{default:o(()=>[e(g,{direction:"vertical"},{default:o(()=>[e(g,null,{default:o(()=>[e(C,{size:"large"},{default:o(()=>[m(" 第 "+Z(W+1)+" 条 ",1)]),_:2},1024),e(p,{onClick:oe=>l(O)(K)},{default:o(()=>t[11]||(t[11]=[m("复制")])),_:2,__:[11]},1032,["onClick"])]),_:2},1024),X("p",null,Z(K),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})}}});export{Qe as default};
