import{L as j,a as E,c as K}from"./copy-DWXBTCCc.js";import{f as P}from"./format-YoKwq1Pz.js";import{u as G,_ as J,A as O}from"./Aria2Dialog.vue_vue_type_script_setup_true_lang-C_FNeORP.js";import{p as Q,q as W,b,d as X,s as Y,g as e,F as S,n as Z,h as L,f as o,M as h,j as l,i as s,m as k,k as tt,o as v,e as et,t as I}from"./index-DfK_AuQa.js";import{u as ot}from"./useCommonStore-Cm69_3M8.js";import{L as z}from"./index-CFxShdAm.js";import{C as lt,I as st,S as nt}from"./index-jWhfq8_6.js";import{F as at,a as it}from"./index-BrDyvP4W.js";import{B as rt}from"./index-DfLWWs_9.js";import{l as B}from"./link-CiL30B4K.js";import{T as ut}from"./index-BB20r3vW.js";import{T as mt}from"./index-B4XBjvuu.js";import{_ as pt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./omit-BSm0-P2Q.js";import"./fileList-DOI4PbIu.js";import"./index-CizeZEZA.js";import"./index-CIv83i9o.js";import"./fake-arrow-XbHKTFne.js";import"./index-CJhdthvT.js";import"./index-3CbCL5Pk.js";import"./add-NVN9jDI3.js";const dt=f=>Q.request("get","/user/history",{params:f}),_t=W("history",()=>{const[f,i,r,n]=ot(dt,()=>{m.value=[],u.value=[]}),u=b([]),m=b([]);return{selectReq:f,pagination:i,historyList:r,getHistory:n,selectedRowKeys:u,selectedRows:m,handleSelectChange:(y,C)=>{u.value=y,m.value=C.selectedRowData.map(p=>({filename:p.file.filename,urls:p.urls,ua:p.ua}))}}}),ft=X({__name:"index",setup(f){const i=G(),r=_t(),{selectReq:n,pagination:u,historyList:m,selectedRowKeys:R,selectedRows:y}=Y(r),C={token:[{required:!0,message:"请输入卡密"}]},p=b([{colKey:"row-select",type:"multiple",width:50,fixed:"left"},{colKey:"file.filename",title:"文件名",ellipsis:!0},{colKey:"ua",title:"下载UA",cell:(c,{row:t})=>e(z,{onClick:()=>K(t.ua)},{default:()=>[e(B,null,null),t.ua]}),ellipsis:!0},{colKey:"created_at",title:"解析时间",ellipsis:!0},{colKey:"size",title:"文件大小",cell:(c,{row:t})=>e(S,null,[P(t.file.size)]),ellipsis:!0}]),x=async({validateResult:c})=>{c===!0&&(await r.getHistory(),localStorage.setItem("token",n.value.token),h.success("查询成功"))};return Z(()=>{n.value.token=localStorage.getItem("token")??"guest",x({validateResult:!0})}),(c,t)=>{const F=st,w=it,d=rt,_=nt,T=at,A=lt,V=z,q=O,H=mt,M=E,$=j,U=ut;return v(),L(S,null,[e(A,null,{default:o(()=>[e(T,{data:l(n),rules:C,onSubmit:x},{default:o(()=>[e(w,{name:"token",label:"卡密"},{default:o(()=>[e(F,{modelValue:l(n).token,"onUpdate:modelValue":t[0]||(t[0]=a=>l(n).token=a)},null,8,["modelValue"])]),_:1}),e(w,null,{default:o(()=>[e(_,{size:"small"},{default:o(()=>[e(d,{type:"submit"},{default:o(()=>t[2]||(t[2]=[s(" 查询 ")])),_:1,__:[2]})]),_:1})]),_:1})]),_:1},8,["data"])]),_:1}),e(A,null,{default:o(()=>[e(_,{direction:"vertical",class:"space"},{default:o(()=>[e(q,null,{default:o(()=>[t[6]||(t[6]=s(" 下载请推荐使用Aria2下载器,如 ")),e(V,{href:"https://motrix.app/",target:"_blank"},{"prefix-icon":o(()=>[e(l(B))]),default:o(()=>[t[3]||(t[3]=s(" Motrix "))]),_:1,__:[3]}),t[7]||(t[7]=k("p",null,"IDM下载需要手动指定UA,点击即可复制",-1)),t[8]||(t[8]=k("p",null,"如果当前链接下载失败,请尝试更换链接,如果全部不可用可重新解析该文件",-1)),t[9]||(t[9]=k("br",null,null,-1)),e(_,null,{default:o(()=>[e(d,{onClick:l(i).showAria2Config},{default:o(()=>t[4]||(t[4]=[s(" 修改Aria2配置 ")])),_:1,__:[4]},8,["onClick"]),e(d,{onClick:t[1]||(t[1]=a=>l(i).downloadLinks(l(y)))},{default:o(()=>t[5]||(t[5]=[s("批量发送")])),_:1,__:[5]})]),_:1})]),_:1,__:[6,7,8,9]}),e(U,{"row-key":"id",resizable:"","lazy-load":"",bordered:!0,data:l(m),pagination:l(u),columns:p.value,"select-on-row-click":!0,selectedRowKeys:l(R),onSelectChange:l(r).handleSelectChange},{expandedRow:o(({row:a})=>[e($,{split:"",size:"large"},{default:o(()=>[(v(!0),L(S,null,tt(a.urls,(g,D)=>(v(),et(M,{key:g},{default:o(()=>[e(_,{direction:"vertical"},{default:o(()=>[e(_,null,{default:o(()=>[e(H,{size:"large"},{default:o(()=>[s(" 第 "+I(D+1)+" 条 ",1)]),_:2},1024),e(d,{onClick:N=>l(K)(g)},{default:o(()=>t[10]||(t[10]=[s("复制")])),_:2,__:[10]},1032,["onClick"]),e(d,{onClick:N=>l(i).addAria2Url(g,a.filename,a.ua,16)},{default:o(()=>t[11]||(t[11]=[s("发送到Aria2下载器")])),_:2,__:[11]},1032,["onClick"])]),_:2},1024),k("p",null,I(g),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:1},8,["data","pagination","columns","selectedRowKeys","onSelectChange"])]),_:1})]),_:1}),e(J)],64)}}}),Ht=pt(ft,[["__scopeId","data-v-534333eb"]]);export{Ht as default};
